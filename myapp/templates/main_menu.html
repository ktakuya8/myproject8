{% extends 'base.html' %}

{% block head %}
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1 class="text-center">メインメニュー</h1>
    
    <div class="chart-container">
        <h2>食事記録</h2>
        <canvas id="foodChart"></canvas>
        <div class="progress-container">
            <p>カロリー摂取: <span id="calorieProgress">{{ food_achievement }}%</span></p>
        </div>
    </div>
    
    <div class="chart-container">
        <h2>運動記録</h2>
        <canvas id="exerciseChart"></canvas>
        <div class="progress-container">
            <p>運動時間: <span id="exerciseProgress">{{ exercise_achievement }}%</span></p>
        </div>
    </div>

    <div class="chart-container">
        <h2>睡眠記録</h2>
        <canvas id="sleepChart"></canvas>
        <div class="progress-container">
            <p>睡眠時間: <span id="sleepProgress">{{ sleep_achievement }}%</span></p>
        </div>
    </div>
   
    <div class="text-center mt-3">
        <a href="{% url 'myapp:logout' %}" class="btn btn-primary">ログアウト</a>
    </div>
</div>

<!-- Popper.js, Bootstrap JS, and jQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const foodData = {{ past_week_food|safe }};
    const exerciseData = {{ past_week_exercise|safe }};
    const sleepData = {{ past_week_sleep|safe }};

    createChart('foodChart', foodData, '摂取カロリー (kcal)', 'rgb(255, 99, 132)');
    createChart('exerciseChart', exerciseData, '運動時間 (分)', 'rgb(54, 162, 235)');
    createChart('sleepChart', sleepData, '睡眠時間 (時間)', 'rgb(75, 192, 192)');
});

function createChart(chartId, data, label, borderColor) {
    const ctx = document.getElementById(chartId).getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['月', '火', '水', '木', '金', '土', '日'],
            datasets: [{
                label: label,
                data: data,
                borderColor: borderColor,
                backgroundColor: 'rgba(0,0,0,0)',
                fill: false,
                lineTension: 0.3
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
}
</script>
{% endblock %}
